{"dependencies":[{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"],"imports":1}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"],"imports":1}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"],"imports":1}},{"name":"debug","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":182},"end":{"line":4,"column":32,"index":214}}],"key":"Nx7LMnUOZdRc8E6QIb5nvmtJE+4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"WT\", {\n    enumerable: true,\n    get: function () {\n      return WT;\n    }\n  });\n  var _transportJs = require(_dependencyMap[0], \"../transport.js\");\n  var _globalsNodeJs = require(_dependencyMap[1], \"../globals.node.js\");\n  var _engineIoParser = require(_dependencyMap[2], \"engine.io-parser\");\n  var _debug = require(_dependencyMap[3], \"debug\");\n  var debugModule = _interopDefault(_debug);\n  // debug()\n  const debug = (0, debugModule.default)(\"engine.io-client:webtransport\"); // debug()\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  class WT extends _transportJs.Transport {\n    get name() {\n      return \"webtransport\";\n    }\n    doOpen() {\n      try {\n        // @ts-ignore\n        this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n      } catch (err) {\n        return this.emitReserved(\"error\", err);\n      }\n      this._transport.closed.then(() => {\n        debug(\"transport closed gracefully\");\n        this.onClose();\n      }).catch(err => {\n        debug(\"transport closed due to %s\", err);\n        this.onError(\"webtransport error\", err);\n      });\n      // note: we could have used async/await, but that would require some additional polyfills\n      this._transport.ready.then(() => {\n        this._transport.createBidirectionalStream().then(stream => {\n          const decoderStream = (0, _engineIoParser.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n          const reader = stream.readable.pipeThrough(decoderStream).getReader();\n          const encoderStream = (0, _engineIoParser.createPacketEncoderStream)();\n          encoderStream.readable.pipeTo(stream.writable);\n          this._writer = encoderStream.writable.getWriter();\n          const read = () => {\n            reader.read().then(({\n              done,\n              value\n            }) => {\n              if (done) {\n                debug(\"session is closed\");\n                return;\n              }\n              debug(\"received chunk: %o\", value);\n              this.onPacket(value);\n              read();\n            }).catch(err => {\n              debug(\"an error occurred while reading: %s\", err);\n            });\n          };\n          read();\n          const packet = {\n            type: \"open\"\n          };\n          if (this.query.sid) {\n            packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n          }\n          this._writer.write(packet).then(() => this.onOpen());\n        });\n      });\n    }\n    write(packets) {\n      this.writable = false;\n      for (let i = 0; i < packets.length; i++) {\n        const packet = packets[i];\n        const lastPacket = i === packets.length - 1;\n        this._writer.write(packet).then(() => {\n          if (lastPacket) {\n            (0, _globalsNodeJs.nextTick)(() => {\n              this.writable = true;\n              this.emitReserved(\"drain\");\n            }, this.setTimeoutFn);\n          }\n        });\n      }\n    }\n    doClose() {\n      var _a;\n      (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n  }\n});","lineCount":106,"map":[[12,2,14,0,"Object"],[12,8,14,0],[12,9,14,0,"defineProperty"],[12,23,14,0],[12,24,14,0,"exports"],[12,31,14,0],[13,4,14,0,"enumerable"],[13,14,14,0],[14,4,14,0,"get"],[14,7,14,0],[14,18,14,0,"get"],[14,19,14,0],[15,6,14,0],[15,13,14,0,"WT"],[15,15,14,0],[16,4,14,0],[17,2,14,0],[18,2,1,0],[18,6,1,0,"_transportJs"],[18,18,1,0],[18,21,1,0,"require"],[18,28,1,0],[18,29,1,0,"_dependencyMap"],[18,43,1,0],[19,2,2,0],[19,6,2,0,"_globalsNodeJs"],[19,20,2,0],[19,23,2,0,"require"],[19,30,2,0],[19,31,2,0,"_dependencyMap"],[19,45,2,0],[20,2,3,0],[20,6,3,0,"_engineIoParser"],[20,21,3,0],[20,24,3,0,"require"],[20,31,3,0],[20,32,3,0,"_dependencyMap"],[20,46,3,0],[21,2,4,0],[21,6,4,0,"_debug"],[21,12,4,0],[21,15,4,0,"require"],[21,22,4,0],[21,23,4,0,"_dependencyMap"],[21,37,4,0],[22,2,4,0],[22,6,4,0,"debugModule"],[22,17,4,0],[22,20,4,0,"_interopDefault"],[22,35,4,0],[22,36,4,0,"_debug"],[22,42,4,0],[23,2,4,33],[24,2,5,0],[24,8,5,6,"debug"],[24,13,5,11],[24,16,5,14],[24,20,5,14,"debugModule"],[24,31,5,25],[24,32,5,25,"default"],[24,39,5,25],[24,41,5,26],[24,72,5,57],[24,73,5,58],[24,74,5,59],[24,75,5,60],[25,2,6,0],[26,0,7,0],[27,0,8,0],[28,0,9,0],[29,0,10,0],[30,0,11,0],[31,0,12,0],[32,0,13,0],[33,2,14,7],[33,8,14,13,"WT"],[33,10,14,15],[33,19,14,24,"Transport"],[33,31,14,33],[33,32,14,33,"Transport"],[33,41,14,33],[33,42,14,34],[34,4,15,4],[34,8,15,8,"name"],[34,12,15,12,"name"],[34,13,15,12],[34,15,15,15],[35,6,16,8],[35,13,16,15],[35,27,16,29],[36,4,17,4],[37,4,18,4,"doOpen"],[37,10,18,10,"doOpen"],[37,11,18,10],[37,13,18,13],[38,6,19,8],[38,10,19,12],[39,8,20,12],[40,8,21,12],[40,12,21,16],[40,13,21,17,"_transport"],[40,23,21,27],[40,26,21,30],[40,30,21,34,"WebTransport"],[40,42,21,46],[40,43,21,47],[40,47,21,51],[40,48,21,52,"createUri"],[40,57,21,61],[40,58,21,62],[40,65,21,69],[40,66,21,70],[40,68,21,72],[40,72,21,76],[40,73,21,77,"opts"],[40,77,21,81],[40,78,21,82,"transportOptions"],[40,94,21,98],[40,95,21,99],[40,99,21,103],[40,100,21,104,"name"],[40,104,21,108],[40,105,21,109],[40,106,21,110],[41,6,22,8],[41,7,22,9],[41,8,23,8],[41,15,23,15,"err"],[41,18,23,18],[41,20,23,20],[42,8,24,12],[42,15,24,19],[42,19,24,23],[42,20,24,24,"emitReserved"],[42,32,24,36],[42,33,24,37],[42,40,24,44],[42,42,24,46,"err"],[42,45,24,49],[42,46,24,50],[43,6,25,8],[44,6,26,8],[44,10,26,12],[44,11,26,13,"_transport"],[44,21,26,23],[44,22,26,24,"closed"],[44,28,26,30],[44,29,27,13,"then"],[44,33,27,17],[44,34,27,18],[44,40,27,24],[45,8,28,12,"debug"],[45,13,28,17],[45,14,28,18],[45,43,28,47],[45,44,28,48],[46,8,29,12],[46,12,29,16],[46,13,29,17,"onClose"],[46,20,29,24],[46,21,29,25],[46,22,29,26],[47,6,30,8],[47,7,30,9],[47,8,30,10],[47,9,31,13,"catch"],[47,14,31,18],[47,15,31,20,"err"],[47,18,31,23],[47,22,31,28],[48,8,32,12,"debug"],[48,13,32,17],[48,14,32,18],[48,42,32,46],[48,44,32,48,"err"],[48,47,32,51],[48,48,32,52],[49,8,33,12],[49,12,33,16],[49,13,33,17,"onError"],[49,20,33,24],[49,21,33,25],[49,41,33,45],[49,43,33,47,"err"],[49,46,33,50],[49,47,33,51],[50,6,34,8],[50,7,34,9],[50,8,34,10],[51,6,35,8],[52,6,36,8],[52,10,36,12],[52,11,36,13,"_transport"],[52,21,36,23],[52,22,36,24,"ready"],[52,27,36,29],[52,28,36,30,"then"],[52,32,36,34],[52,33,36,35],[52,39,36,41],[53,8,37,12],[53,12,37,16],[53,13,37,17,"_transport"],[53,23,37,27],[53,24,37,28,"createBidirectionalStream"],[53,49,37,53],[53,50,37,54],[53,51,37,55],[53,52,37,56,"then"],[53,56,37,60],[53,57,37,62,"stream"],[53,63,37,68],[53,67,37,73],[54,10,38,16],[54,16,38,22,"decoderStream"],[54,29,38,35],[54,32,38,38],[54,36,38,38,"createPacketDecoderStream"],[54,51,38,63],[54,52,38,63,"createPacketDecoderStream"],[54,77,38,63],[54,79,38,64,"Number"],[54,85,38,70],[54,86,38,71,"MAX_SAFE_INTEGER"],[54,102,38,87],[54,104,38,89],[54,108,38,93],[54,109,38,94,"socket"],[54,115,38,100],[54,116,38,101,"binaryType"],[54,126,38,111],[54,127,38,112],[55,10,39,16],[55,16,39,22,"reader"],[55,22,39,28],[55,25,39,31,"stream"],[55,31,39,37],[55,32,39,38,"readable"],[55,40,39,46],[55,41,39,47,"pipeThrough"],[55,52,39,58],[55,53,39,59,"decoderStream"],[55,66,39,72],[55,67,39,73],[55,68,39,74,"getReader"],[55,77,39,83],[55,78,39,84],[55,79,39,85],[56,10,40,16],[56,16,40,22,"encoderStream"],[56,29,40,35],[56,32,40,38],[56,36,40,38,"createPacketEncoderStream"],[56,51,40,63],[56,52,40,63,"createPacketEncoderStream"],[56,77,40,63],[56,79,40,64],[56,80,40,65],[57,10,41,16,"encoderStream"],[57,23,41,29],[57,24,41,30,"readable"],[57,32,41,38],[57,33,41,39,"pipeTo"],[57,39,41,45],[57,40,41,46,"stream"],[57,46,41,52],[57,47,41,53,"writable"],[57,55,41,61],[57,56,41,62],[58,10,42,16],[58,14,42,20],[58,15,42,21,"_writer"],[58,22,42,28],[58,25,42,31,"encoderStream"],[58,38,42,44],[58,39,42,45,"writable"],[58,47,42,53],[58,48,42,54,"getWriter"],[58,57,42,63],[58,58,42,64],[58,59,42,65],[59,10,43,16],[59,16,43,22,"read"],[59,20,43,26],[59,23,43,29,"read"],[59,24,43,29],[59,29,43,35],[60,12,44,20,"reader"],[60,18,44,26],[60,19,45,25,"read"],[60,23,45,29],[60,24,45,30],[60,25,45,31],[60,26,46,25,"then"],[60,30,46,29],[60,31,46,30],[60,32,46,31],[61,14,46,33,"done"],[61,18,46,37],[62,14,46,39,"value"],[63,12,46,45],[63,13,46,46],[63,18,46,51],[64,14,47,24],[64,18,47,28,"done"],[64,22,47,32],[64,24,47,34],[65,16,48,28,"debug"],[65,21,48,33],[65,22,48,34],[65,41,48,53],[65,42,48,54],[66,16,49,28],[67,14,50,24],[68,14,51,24,"debug"],[68,19,51,29],[68,20,51,30],[68,40,51,50],[68,42,51,52,"value"],[68,47,51,57],[68,48,51,58],[69,14,52,24],[69,18,52,28],[69,19,52,29,"onPacket"],[69,27,52,37],[69,28,52,38,"value"],[69,33,52,43],[69,34,52,44],[70,14,53,24,"read"],[70,18,53,28],[70,19,53,29],[70,20,53,30],[71,12,54,20],[71,13,54,21],[71,14,54,22],[71,15,55,25,"catch"],[71,20,55,30],[71,21,55,32,"err"],[71,24,55,35],[71,28,55,40],[72,14,56,24,"debug"],[72,19,56,29],[72,20,56,30],[72,57,56,67],[72,59,56,69,"err"],[72,62,56,72],[72,63,56,73],[73,12,57,20],[73,13,57,21],[73,14,57,22],[74,10,58,16],[74,11,58,17],[75,10,59,16,"read"],[75,14,59,20],[75,15,59,21],[75,16,59,22],[76,10,60,16],[76,16,60,22,"packet"],[76,22,60,28],[76,25,60,31],[77,12,60,33,"type"],[77,16,60,37],[77,18,60,39],[78,10,60,46],[78,11,60,47],[79,10,61,16],[79,14,61,20],[79,18,61,24],[79,19,61,25,"query"],[79,24,61,30],[79,25,61,31,"sid"],[79,28,61,34],[79,30,61,36],[80,12,62,20,"packet"],[80,18,62,26],[80,19,62,27,"data"],[80,23,62,31],[80,26,62,34],[80,37,62,45],[80,41,62,49],[80,42,62,50,"query"],[80,47,62,55],[80,48,62,56,"sid"],[80,51,62,59],[80,55,62,63],[81,10,63,16],[82,10,64,16],[82,14,64,20],[82,15,64,21,"_writer"],[82,22,64,28],[82,23,64,29,"write"],[82,28,64,34],[82,29,64,35,"packet"],[82,35,64,41],[82,36,64,42],[82,37,64,43,"then"],[82,41,64,47],[82,42,64,48],[82,48,64,54],[82,52,64,58],[82,53,64,59,"onOpen"],[82,59,64,65],[82,60,64,66],[82,61,64,67],[82,62,64,68],[83,8,65,12],[83,9,65,13],[83,10,65,14],[84,6,66,8],[84,7,66,9],[84,8,66,10],[85,4,67,4],[86,4,68,4,"write"],[86,9,68,9,"write"],[86,10,68,10,"packets"],[86,17,68,17],[86,19,68,19],[87,6,69,8],[87,10,69,12],[87,11,69,13,"writable"],[87,19,69,21],[87,22,69,24],[87,27,69,29],[88,6,70,8],[88,11,70,13],[88,15,70,17,"i"],[88,16,70,18],[88,19,70,21],[88,20,70,22],[88,22,70,24,"i"],[88,23,70,25],[88,26,70,28,"packets"],[88,33,70,35],[88,34,70,36,"length"],[88,40,70,42],[88,42,70,44,"i"],[88,43,70,45],[88,45,70,47],[88,47,70,49],[89,8,71,12],[89,14,71,18,"packet"],[89,20,71,24],[89,23,71,27,"packets"],[89,30,71,34],[89,31,71,35,"i"],[89,32,71,36],[89,33,71,37],[90,8,72,12],[90,14,72,18,"lastPacket"],[90,24,72,28],[90,27,72,31,"i"],[90,28,72,32],[90,33,72,37,"packets"],[90,40,72,44],[90,41,72,45,"length"],[90,47,72,51],[90,50,72,54],[90,51,72,55],[91,8,73,12],[91,12,73,16],[91,13,73,17,"_writer"],[91,20,73,24],[91,21,73,25,"write"],[91,26,73,30],[91,27,73,31,"packet"],[91,33,73,37],[91,34,73,38],[91,35,73,39,"then"],[91,39,73,43],[91,40,73,44],[91,46,73,50],[92,10,74,16],[92,14,74,20,"lastPacket"],[92,24,74,30],[92,26,74,32],[93,12,75,20],[93,16,75,20,"nextTick"],[93,30,75,28],[93,31,75,28,"nextTick"],[93,39,75,28],[93,41,75,29],[93,47,75,35],[94,14,76,24],[94,18,76,28],[94,19,76,29,"writable"],[94,27,76,37],[94,30,76,40],[94,34,76,44],[95,14,77,24],[95,18,77,28],[95,19,77,29,"emitReserved"],[95,31,77,41],[95,32,77,42],[95,39,77,49],[95,40,77,50],[96,12,78,20],[96,13,78,21],[96,15,78,23],[96,19,78,27],[96,20,78,28,"setTimeoutFn"],[96,32,78,40],[96,33,78,41],[97,10,79,16],[98,8,80,12],[98,9,80,13],[98,10,80,14],[99,6,81,8],[100,4,82,4],[101,4,83,4,"doClose"],[101,11,83,11,"doClose"],[101,12,83,11],[101,14,83,14],[102,6,84,8],[102,10,84,12,"_a"],[102,12,84,14],[103,6,85,8],[103,7,85,9,"_a"],[103,9,85,11],[103,12,85,14],[103,16,85,18],[103,17,85,19,"_transport"],[103,27,85,29],[103,33,85,35],[103,37,85,39],[103,41,85,43,"_a"],[103,43,85,45],[103,48,85,50],[103,53,85,55],[103,54,85,56],[103,57,85,59],[103,62,85,64],[103,63,85,65],[103,66,85,68,"_a"],[103,68,85,70],[103,69,85,71,"close"],[103,74,85,76],[103,75,85,77],[103,76,85,78],[104,4,86,4],[105,2,87,0],[106,0,87,1],[106,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCa;ICC;KDE;IEC;kBCS;SDG;mBEC;SFG;mCGE;6DCC;6BCM;8BCG;qBDQ;+BEC;qBFE;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"},"hasCjsExports":false},"type":"js/module"}]}