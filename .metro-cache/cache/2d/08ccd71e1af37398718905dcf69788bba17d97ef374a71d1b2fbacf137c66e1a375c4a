{"dependencies":[{"name":"./is-binary.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":42,"index":42}}],"key":"nI6Cd4R9sJDIQIUaBK8/eqMqCAI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.deconstructPacket = deconstructPacket;\n  exports.reconstructPacket = reconstructPacket;\n  var _isBinaryJs = require(_dependencyMap[0], \"./is-binary.js\");\n  /**\n   * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n   *\n   * @param {Object} packet - socket.io event packet\n   * @return {Object} with deconstructed packet and list of buffers\n   * @public\n   */\n  function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return {\n      packet: pack,\n      buffers: buffers\n    };\n  }\n  function _deconstructPacket(data, buffers) {\n    if (!data) return data;\n    if ((0, _isBinaryJs.isBinary)(data)) {\n      const placeholder = {\n        _placeholder: true,\n        num: buffers.length\n      };\n      buffers.push(data);\n      return placeholder;\n    } else if (Array.isArray(data)) {\n      const newData = new Array(data.length);\n      for (let i = 0; i < data.length; i++) {\n        newData[i] = _deconstructPacket(data[i], buffers);\n      }\n      return newData;\n    } else if (typeof data === \"object\" && !(data instanceof Date)) {\n      const newData = {};\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          newData[key] = _deconstructPacket(data[key], buffers);\n        }\n      }\n      return newData;\n    }\n    return data;\n  }\n  /**\n   * Reconstructs a binary packet from its placeholder packet and buffers\n   *\n   * @param {Object} packet - event packet with placeholders\n   * @param {Array} buffers - binary buffers to put in placeholder positions\n   * @return {Object} reconstructed packet\n   * @public\n   */\n  function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n  }\n  function _reconstructPacket(data, buffers) {\n    if (!data) return data;\n    if (data && data._placeholder === true) {\n      const isIndexValid = typeof data.num === \"number\" && data.num >= 0 && data.num < buffers.length;\n      if (isIndexValid) {\n        return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n      } else {\n        throw new Error(\"illegal attachments\");\n      }\n    } else if (Array.isArray(data)) {\n      for (let i = 0; i < data.length; i++) {\n        data[i] = _reconstructPacket(data[i], buffers);\n      }\n    } else if (typeof data === \"object\") {\n      for (const key in data) {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n          data[key] = _reconstructPacket(data[key], buffers);\n        }\n      }\n    }\n    return data;\n  }\n});","lineCount":89,"map":[[7,2,9,0,"exports"],[7,9,9,0],[7,10,9,0,"deconstructPacket"],[7,27,9,0],[7,30,9,0,"deconstructPacket"],[7,47,9,0],[8,2,51,0,"exports"],[8,9,51,0],[8,10,51,0,"reconstructPacket"],[8,27,51,0],[8,30,51,0,"reconstructPacket"],[8,47,51,0],[9,2,1,0],[9,6,1,0,"_isBinaryJs"],[9,17,1,0],[9,20,1,0,"require"],[9,27,1,0],[9,28,1,0,"_dependencyMap"],[9,42,1,0],[10,2,2,0],[11,0,3,0],[12,0,4,0],[13,0,5,0],[14,0,6,0],[15,0,7,0],[16,0,8,0],[17,2,9,7],[17,11,9,16,"deconstructPacket"],[17,28,9,33,"deconstructPacket"],[17,29,9,34,"packet"],[17,35,9,40],[17,37,9,42],[18,4,10,4],[18,10,10,10,"buffers"],[18,17,10,17],[18,20,10,20],[18,22,10,22],[19,4,11,4],[19,10,11,10,"packetData"],[19,20,11,20],[19,23,11,23,"packet"],[19,29,11,29],[19,30,11,30,"data"],[19,34,11,34],[20,4,12,4],[20,10,12,10,"pack"],[20,14,12,14],[20,17,12,17,"packet"],[20,23,12,23],[21,4,13,4,"pack"],[21,8,13,8],[21,9,13,9,"data"],[21,13,13,13],[21,16,13,16,"_deconstructPacket"],[21,34,13,34],[21,35,13,35,"packetData"],[21,45,13,45],[21,47,13,47,"buffers"],[21,54,13,54],[21,55,13,55],[22,4,14,4,"pack"],[22,8,14,8],[22,9,14,9,"attachments"],[22,20,14,20],[22,23,14,23,"buffers"],[22,30,14,30],[22,31,14,31,"length"],[22,37,14,37],[22,38,14,38],[22,39,14,39],[23,4,15,4],[23,11,15,11],[24,6,15,13,"packet"],[24,12,15,19],[24,14,15,21,"pack"],[24,18,15,25],[25,6,15,27,"buffers"],[25,13,15,34],[25,15,15,36,"buffers"],[26,4,15,44],[26,5,15,45],[27,2,16,0],[28,2,17,0],[28,11,17,9,"_deconstructPacket"],[28,29,17,27,"_deconstructPacket"],[28,30,17,28,"data"],[28,34,17,32],[28,36,17,34,"buffers"],[28,43,17,41],[28,45,17,43],[29,4,18,4],[29,8,18,8],[29,9,18,9,"data"],[29,13,18,13],[29,15,19,8],[29,22,19,15,"data"],[29,26,19,19],[30,4,20,4],[30,8,20,8],[30,12,20,8,"isBinary"],[30,23,20,16],[30,24,20,16,"isBinary"],[30,32,20,16],[30,34,20,17,"data"],[30,38,20,21],[30,39,20,22],[30,41,20,24],[31,6,21,8],[31,12,21,14,"placeholder"],[31,23,21,25],[31,26,21,28],[32,8,21,30,"_placeholder"],[32,20,21,42],[32,22,21,44],[32,26,21,48],[33,8,21,50,"num"],[33,11,21,53],[33,13,21,55,"buffers"],[33,20,21,62],[33,21,21,63,"length"],[34,6,21,70],[34,7,21,71],[35,6,22,8,"buffers"],[35,13,22,15],[35,14,22,16,"push"],[35,18,22,20],[35,19,22,21,"data"],[35,23,22,25],[35,24,22,26],[36,6,23,8],[36,13,23,15,"placeholder"],[36,24,23,26],[37,4,24,4],[37,5,24,5],[37,11,25,9],[37,15,25,13,"Array"],[37,20,25,18],[37,21,25,19,"isArray"],[37,28,25,26],[37,29,25,27,"data"],[37,33,25,31],[37,34,25,32],[37,36,25,34],[38,6,26,8],[38,12,26,14,"newData"],[38,19,26,21],[38,22,26,24],[38,26,26,28,"Array"],[38,31,26,33],[38,32,26,34,"data"],[38,36,26,38],[38,37,26,39,"length"],[38,43,26,45],[38,44,26,46],[39,6,27,8],[39,11,27,13],[39,15,27,17,"i"],[39,16,27,18],[39,19,27,21],[39,20,27,22],[39,22,27,24,"i"],[39,23,27,25],[39,26,27,28,"data"],[39,30,27,32],[39,31,27,33,"length"],[39,37,27,39],[39,39,27,41,"i"],[39,40,27,42],[39,42,27,44],[39,44,27,46],[40,8,28,12,"newData"],[40,15,28,19],[40,16,28,20,"i"],[40,17,28,21],[40,18,28,22],[40,21,28,25,"_deconstructPacket"],[40,39,28,43],[40,40,28,44,"data"],[40,44,28,48],[40,45,28,49,"i"],[40,46,28,50],[40,47,28,51],[40,49,28,53,"buffers"],[40,56,28,60],[40,57,28,61],[41,6,29,8],[42,6,30,8],[42,13,30,15,"newData"],[42,20,30,22],[43,4,31,4],[43,5,31,5],[43,11,32,9],[43,15,32,13],[43,22,32,20,"data"],[43,26,32,24],[43,31,32,29],[43,39,32,37],[43,43,32,41],[43,45,32,43,"data"],[43,49,32,47],[43,61,32,59,"Date"],[43,65,32,63],[43,66,32,64],[43,68,32,66],[44,6,33,8],[44,12,33,14,"newData"],[44,19,33,21],[44,22,33,24],[44,23,33,25],[44,24,33,26],[45,6,34,8],[45,11,34,13],[45,17,34,19,"key"],[45,20,34,22],[45,24,34,26,"data"],[45,28,34,30],[45,30,34,32],[46,8,35,12],[46,12,35,16,"Object"],[46,18,35,22],[46,19,35,23,"prototype"],[46,28,35,32],[46,29,35,33,"hasOwnProperty"],[46,43,35,47],[46,44,35,48,"call"],[46,48,35,52],[46,49,35,53,"data"],[46,53,35,57],[46,55,35,59,"key"],[46,58,35,62],[46,59,35,63],[46,61,35,65],[47,10,36,16,"newData"],[47,17,36,23],[47,18,36,24,"key"],[47,21,36,27],[47,22,36,28],[47,25,36,31,"_deconstructPacket"],[47,43,36,49],[47,44,36,50,"data"],[47,48,36,54],[47,49,36,55,"key"],[47,52,36,58],[47,53,36,59],[47,55,36,61,"buffers"],[47,62,36,68],[47,63,36,69],[48,8,37,12],[49,6,38,8],[50,6,39,8],[50,13,39,15,"newData"],[50,20,39,22],[51,4,40,4],[52,4,41,4],[52,11,41,11,"data"],[52,15,41,15],[53,2,42,0],[54,2,43,0],[55,0,44,0],[56,0,45,0],[57,0,46,0],[58,0,47,0],[59,0,48,0],[60,0,49,0],[61,0,50,0],[62,2,51,7],[62,11,51,16,"reconstructPacket"],[62,28,51,33,"reconstructPacket"],[62,29,51,34,"packet"],[62,35,51,40],[62,37,51,42,"buffers"],[62,44,51,49],[62,46,51,51],[63,4,52,4,"packet"],[63,10,52,10],[63,11,52,11,"data"],[63,15,52,15],[63,18,52,18,"_reconstructPacket"],[63,36,52,36],[63,37,52,37,"packet"],[63,43,52,43],[63,44,52,44,"data"],[63,48,52,48],[63,50,52,50,"buffers"],[63,57,52,57],[63,58,52,58],[64,4,53,4],[64,11,53,11,"packet"],[64,17,53,17],[64,18,53,18,"attachments"],[64,29,53,29],[64,30,53,30],[64,31,53,31],[65,4,54,4],[65,11,54,11,"packet"],[65,17,54,17],[66,2,55,0],[67,2,56,0],[67,11,56,9,"_reconstructPacket"],[67,29,56,27,"_reconstructPacket"],[67,30,56,28,"data"],[67,34,56,32],[67,36,56,34,"buffers"],[67,43,56,41],[67,45,56,43],[68,4,57,4],[68,8,57,8],[68,9,57,9,"data"],[68,13,57,13],[68,15,58,8],[68,22,58,15,"data"],[68,26,58,19],[69,4,59,4],[69,8,59,8,"data"],[69,12,59,12],[69,16,59,16,"data"],[69,20,59,20],[69,21,59,21,"_placeholder"],[69,33,59,33],[69,38,59,38],[69,42,59,42],[69,44,59,44],[70,6,60,8],[70,12,60,14,"isIndexValid"],[70,24,60,26],[70,27,60,29],[70,34,60,36,"data"],[70,38,60,40],[70,39,60,41,"num"],[70,42,60,44],[70,47,60,49],[70,55,60,57],[70,59,61,12,"data"],[70,63,61,16],[70,64,61,17,"num"],[70,67,61,20],[70,71,61,24],[70,72,61,25],[70,76,62,12,"data"],[70,80,62,16],[70,81,62,17,"num"],[70,84,62,20],[70,87,62,23,"buffers"],[70,94,62,30],[70,95,62,31,"length"],[70,101,62,37],[71,6,63,8],[71,10,63,12,"isIndexValid"],[71,22,63,24],[71,24,63,26],[72,8,64,12],[72,15,64,19,"buffers"],[72,22,64,26],[72,23,64,27,"data"],[72,27,64,31],[72,28,64,32,"num"],[72,31,64,35],[72,32,64,36],[72,33,64,37],[72,34,64,38],[73,6,65,8],[73,7,65,9],[73,13,66,13],[74,8,67,12],[74,14,67,18],[74,18,67,22,"Error"],[74,23,67,27],[74,24,67,28],[74,45,67,49],[74,46,67,50],[75,6,68,8],[76,4,69,4],[76,5,69,5],[76,11,70,9],[76,15,70,13,"Array"],[76,20,70,18],[76,21,70,19,"isArray"],[76,28,70,26],[76,29,70,27,"data"],[76,33,70,31],[76,34,70,32],[76,36,70,34],[77,6,71,8],[77,11,71,13],[77,15,71,17,"i"],[77,16,71,18],[77,19,71,21],[77,20,71,22],[77,22,71,24,"i"],[77,23,71,25],[77,26,71,28,"data"],[77,30,71,32],[77,31,71,33,"length"],[77,37,71,39],[77,39,71,41,"i"],[77,40,71,42],[77,42,71,44],[77,44,71,46],[78,8,72,12,"data"],[78,12,72,16],[78,13,72,17,"i"],[78,14,72,18],[78,15,72,19],[78,18,72,22,"_reconstructPacket"],[78,36,72,40],[78,37,72,41,"data"],[78,41,72,45],[78,42,72,46,"i"],[78,43,72,47],[78,44,72,48],[78,46,72,50,"buffers"],[78,53,72,57],[78,54,72,58],[79,6,73,8],[80,4,74,4],[80,5,74,5],[80,11,75,9],[80,15,75,13],[80,22,75,20,"data"],[80,26,75,24],[80,31,75,29],[80,39,75,37],[80,41,75,39],[81,6,76,8],[81,11,76,13],[81,17,76,19,"key"],[81,20,76,22],[81,24,76,26,"data"],[81,28,76,30],[81,30,76,32],[82,8,77,12],[82,12,77,16,"Object"],[82,18,77,22],[82,19,77,23,"prototype"],[82,28,77,32],[82,29,77,33,"hasOwnProperty"],[82,43,77,47],[82,44,77,48,"call"],[82,48,77,52],[82,49,77,53,"data"],[82,53,77,57],[82,55,77,59,"key"],[82,58,77,62],[82,59,77,63],[82,61,77,65],[83,10,78,16,"data"],[83,14,78,20],[83,15,78,21,"key"],[83,18,78,24],[83,19,78,25],[83,22,78,28,"_reconstructPacket"],[83,40,78,46],[83,41,78,47,"data"],[83,45,78,51],[83,46,78,52,"key"],[83,49,78,55],[83,50,78,56],[83,52,78,58,"buffers"],[83,59,78,65],[83,60,78,66],[84,8,79,12],[85,6,80,8],[86,4,81,4],[87,4,82,4],[87,11,82,11,"data"],[87,15,82,15],[88,2,83,0],[89,0,83,1],[89,3]],"functionMap":{"names":["<global>","deconstructPacket","_deconstructPacket","reconstructPacket","_reconstructPacket"],"mappings":"AAA;OCQ;CDO;AEC;CFyB;OGS;CHI;AIC;CJ2B"},"hasCjsExports":false},"type":"js/module"}]}