{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/callSuper","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"378KbBHdmndC3iMXZ2Ix8oB3LeE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"],"imports":1}},{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"],"imports":1}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"],"imports":1}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"WT\", {\n    enumerable: true,\n    get: function () {\n      return WT;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\");\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\");\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _babelRuntimeHelpersCallSuper = require(_dependencyMap[2], \"@babel/runtime/helpers/callSuper\");\n  var _callSuper = _interopDefault(_babelRuntimeHelpersCallSuper);\n  var _babelRuntimeHelpersInherits = require(_dependencyMap[3], \"@babel/runtime/helpers/inherits\");\n  var _inherits = _interopDefault(_babelRuntimeHelpersInherits);\n  var _transportJs = require(_dependencyMap[4], \"../transport.js\");\n  var _globalsNodeJs = require(_dependencyMap[5], \"../globals.node.js\");\n  var _engineIoParser = require(_dependencyMap[6], \"engine.io-parser\");\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  var WT = /*#__PURE__*/function (_Transport) {\n    function WT() {\n      (0, _classCallCheck.default)(this, WT);\n      return (0, _callSuper.default)(this, WT, arguments);\n    }\n    (0, _inherits.default)(WT, _Transport);\n    return (0, _createClass.default)(WT, [{\n      key: \"name\",\n      get: function () {\n        return \"webtransport\";\n      }\n    }, {\n      key: \"doOpen\",\n      value: function doOpen() {\n        try {\n          // @ts-ignore\n          this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        } catch (err) {\n          return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed.then(() => {\n          this.onClose();\n        }).catch(err => {\n          this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n          this._transport.createBidirectionalStream().then(stream => {\n            var decoderStream = (0, _engineIoParser.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n            var reader = stream.readable.pipeThrough(decoderStream).getReader();\n            var encoderStream = (0, _engineIoParser.createPacketEncoderStream)();\n            encoderStream.readable.pipeTo(stream.writable);\n            this._writer = encoderStream.writable.getWriter();\n            var read = () => {\n              reader.read().then(_ref => {\n                var done = _ref.done,\n                  value = _ref.value;\n                if (done) {\n                  return;\n                }\n                this.onPacket(value);\n                read();\n              }).catch(err => {});\n            };\n            read();\n            var packet = {\n              type: \"open\"\n            };\n            if (this.query.sid) {\n              packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n            }\n            this._writer.write(packet).then(() => this.onOpen());\n          });\n        });\n      }\n    }, {\n      key: \"write\",\n      value: function write(packets) {\n        var _this = this;\n        this.writable = false;\n        var _loop = function () {\n          var packet = packets[i];\n          var lastPacket = i === packets.length - 1;\n          _this._writer.write(packet).then(() => {\n            if (lastPacket) {\n              (0, _globalsNodeJs.nextTick)(() => {\n                _this.writable = true;\n                _this.emitReserved(\"drain\");\n              }, _this.setTimeoutFn);\n            }\n          });\n        };\n        for (var i = 0; i < packets.length; i++) {\n          _loop();\n        }\n      }\n    }, {\n      key: \"doClose\",\n      value: function doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n      }\n    }]);\n  }(_transportJs.Transport);\n});","lineCount":121,"map":[[12,2,12,0,"Object"],[12,8,12,0],[12,9,12,0,"defineProperty"],[12,23,12,0],[12,24,12,0,"exports"],[12,31,12,0],[13,4,12,0,"enumerable"],[13,14,12,0],[14,4,12,0,"get"],[14,7,12,0],[14,18,12,0,"get"],[14,19,12,0],[15,6,12,0],[15,13,12,0,"WT"],[15,15,12,0],[16,4,12,0],[17,2,12,0],[18,2,80,1],[18,6,80,1,"_babelRuntimeHelpersClassCallCheck"],[18,40,80,1],[18,43,80,1,"require"],[18,50,80,1],[18,51,80,1,"_dependencyMap"],[18,65,80,1],[19,2,80,1],[19,6,80,1,"_classCallCheck"],[19,21,80,1],[19,24,80,1,"_interopDefault"],[19,39,80,1],[19,40,80,1,"_babelRuntimeHelpersClassCallCheck"],[19,74,80,1],[20,2,80,1],[20,6,80,1,"_babelRuntimeHelpersCreateClass"],[20,37,80,1],[20,40,80,1,"require"],[20,47,80,1],[20,48,80,1,"_dependencyMap"],[20,62,80,1],[21,2,80,1],[21,6,80,1,"_createClass"],[21,18,80,1],[21,21,80,1,"_interopDefault"],[21,36,80,1],[21,37,80,1,"_babelRuntimeHelpersCreateClass"],[21,68,80,1],[22,2,80,1],[22,6,80,1,"_babelRuntimeHelpersCallSuper"],[22,35,80,1],[22,38,80,1,"require"],[22,45,80,1],[22,46,80,1,"_dependencyMap"],[22,60,80,1],[23,2,80,1],[23,6,80,1,"_callSuper"],[23,16,80,1],[23,19,80,1,"_interopDefault"],[23,34,80,1],[23,35,80,1,"_babelRuntimeHelpersCallSuper"],[23,64,80,1],[24,2,80,1],[24,6,80,1,"_babelRuntimeHelpersInherits"],[24,34,80,1],[24,37,80,1,"require"],[24,44,80,1],[24,45,80,1,"_dependencyMap"],[24,59,80,1],[25,2,80,1],[25,6,80,1,"_inherits"],[25,15,80,1],[25,18,80,1,"_interopDefault"],[25,33,80,1],[25,34,80,1,"_babelRuntimeHelpersInherits"],[25,62,80,1],[26,2,1,0],[26,6,1,0,"_transportJs"],[26,18,1,0],[26,21,1,0,"require"],[26,28,1,0],[26,29,1,0,"_dependencyMap"],[26,43,1,0],[27,2,2,0],[27,6,2,0,"_globalsNodeJs"],[27,20,2,0],[27,23,2,0,"require"],[27,30,2,0],[27,31,2,0,"_dependencyMap"],[27,45,2,0],[28,2,3,0],[28,6,3,0,"_engineIoParser"],[28,21,3,0],[28,24,3,0,"require"],[28,31,3,0],[28,32,3,0,"_dependencyMap"],[28,46,3,0],[29,2,4,0],[30,0,5,0],[31,0,6,0],[32,0,7,0],[33,0,8,0],[34,0,9,0],[35,0,10,0],[36,0,11,0],[37,2,4,0],[37,6,12,13,"WT"],[37,8,12,15],[37,34,12,15,"_Transport"],[37,44,12,15],[38,4,12,15],[38,13,12,15,"WT"],[38,16,12,15],[39,6,12,15],[39,10,12,15,"_classCallCheck"],[39,25,12,15],[39,26,12,15,"default"],[39,33,12,15],[39,41,12,15,"WT"],[39,43,12,15],[40,6,12,15],[40,17,12,15,"_callSuper"],[40,27,12,15],[40,28,12,15,"default"],[40,35,12,15],[40,43,12,15,"WT"],[40,45,12,15],[40,47,12,15,"arguments"],[40,56,12,15],[41,4,12,15],[42,4,12,15],[42,8,12,15,"_inherits"],[42,17,12,15],[42,18,12,15,"default"],[42,25,12,15],[42,27,12,15,"WT"],[42,29,12,15],[42,31,12,15,"_Transport"],[42,41,12,15],[43,4,12,15],[43,15,12,15,"_createClass"],[43,27,12,15],[43,28,12,15,"default"],[43,35,12,15],[43,37,12,15,"WT"],[43,39,12,15],[44,6,12,15,"key"],[44,9,12,15],[45,6,12,15,"get"],[45,9,12,15],[45,11,13,4],[45,20,13,4,"get"],[45,21,13,4],[45,23,13,15],[46,8,14,8],[46,15,14,15],[46,29,14,29],[47,6,15,4],[48,4,15,5],[49,6,15,5,"key"],[49,9,15,5],[50,6,15,5,"value"],[50,11,15,5],[50,13,16,4],[50,22,16,4,"doOpen"],[50,28,16,10,"doOpen"],[50,29,16,10],[50,31,16,13],[51,8,17,8],[51,12,17,12],[52,10,18,12],[53,10,19,12],[53,14,19,16],[53,15,19,17,"_transport"],[53,25,19,27],[53,28,19,30],[53,32,19,34,"WebTransport"],[53,44,19,46],[53,45,19,47],[53,49,19,51],[53,50,19,52,"createUri"],[53,59,19,61],[53,60,19,62],[53,67,19,69],[53,68,19,70],[53,70,19,72],[53,74,19,76],[53,75,19,77,"opts"],[53,79,19,81],[53,80,19,82,"transportOptions"],[53,96,19,98],[53,97,19,99],[53,101,19,103],[53,102,19,104,"name"],[53,106,19,108],[53,107,19,109],[53,108,19,110],[54,8,20,8],[54,9,20,9],[54,10,21,8],[54,17,21,15,"err"],[54,20,21,18],[54,22,21,20],[55,10,22,12],[55,17,22,19],[55,21,22,23],[55,22,22,24,"emitReserved"],[55,34,22,36],[55,35,22,37],[55,42,22,44],[55,44,22,46,"err"],[55,47,22,49],[55,48,22,50],[56,8,23,8],[57,8,24,8],[57,12,24,12],[57,13,24,13,"_transport"],[57,23,24,23],[57,24,24,24,"closed"],[57,30,24,30],[57,31,25,13,"then"],[57,35,25,17],[57,36,25,18],[57,42,25,24],[58,10,26,12],[58,14,26,16],[58,15,26,17,"onClose"],[58,22,26,24],[58,23,26,25],[58,24,26,26],[59,8,27,8],[59,9,27,9],[59,10,27,10],[59,11,28,13,"catch"],[59,16,28,18],[59,17,28,20,"err"],[59,20,28,23],[59,24,28,28],[60,10,29,12],[60,14,29,16],[60,15,29,17,"onError"],[60,22,29,24],[60,23,29,25],[60,43,29,45],[60,45,29,47,"err"],[60,48,29,50],[60,49,29,51],[61,8,30,8],[61,9,30,9],[61,10,30,10],[62,8,31,8],[63,8,32,8],[63,12,32,12],[63,13,32,13,"_transport"],[63,23,32,23],[63,24,32,24,"ready"],[63,29,32,29],[63,30,32,30,"then"],[63,34,32,34],[63,35,32,35],[63,41,32,41],[64,10,33,12],[64,14,33,16],[64,15,33,17,"_transport"],[64,25,33,27],[64,26,33,28,"createBidirectionalStream"],[64,51,33,53],[64,52,33,54],[64,53,33,55],[64,54,33,56,"then"],[64,58,33,60],[64,59,33,62,"stream"],[64,65,33,68],[64,69,33,73],[65,12,34,16],[65,16,34,22,"decoderStream"],[65,29,34,35],[65,32,34,38],[65,36,34,38,"createPacketDecoderStream"],[65,51,34,63],[65,52,34,63,"createPacketDecoderStream"],[65,77,34,63],[65,79,34,64,"Number"],[65,85,34,70],[65,86,34,71,"MAX_SAFE_INTEGER"],[65,102,34,87],[65,104,34,89],[65,108,34,93],[65,109,34,94,"socket"],[65,115,34,100],[65,116,34,101,"binaryType"],[65,126,34,111],[65,127,34,112],[66,12,35,16],[66,16,35,22,"reader"],[66,22,35,28],[66,25,35,31,"stream"],[66,31,35,37],[66,32,35,38,"readable"],[66,40,35,46],[66,41,35,47,"pipeThrough"],[66,52,35,58],[66,53,35,59,"decoderStream"],[66,66,35,72],[66,67,35,73],[66,68,35,74,"getReader"],[66,77,35,83],[66,78,35,84],[66,79,35,85],[67,12,36,16],[67,16,36,22,"encoderStream"],[67,29,36,35],[67,32,36,38],[67,36,36,38,"createPacketEncoderStream"],[67,51,36,63],[67,52,36,63,"createPacketEncoderStream"],[67,77,36,63],[67,79,36,64],[67,80,36,65],[68,12,37,16,"encoderStream"],[68,25,37,29],[68,26,37,30,"readable"],[68,34,37,38],[68,35,37,39,"pipeTo"],[68,41,37,45],[68,42,37,46,"stream"],[68,48,37,52],[68,49,37,53,"writable"],[68,57,37,61],[68,58,37,62],[69,12,38,16],[69,16,38,20],[69,17,38,21,"_writer"],[69,24,38,28],[69,27,38,31,"encoderStream"],[69,40,38,44],[69,41,38,45,"writable"],[69,49,38,53],[69,50,38,54,"getWriter"],[69,59,38,63],[69,60,38,64],[69,61,38,65],[70,12,39,16],[70,16,39,22,"read"],[70,20,39,26],[70,23,39,29,"read"],[70,24,39,29],[70,29,39,35],[71,14,40,20,"reader"],[71,20,40,26],[71,21,41,25,"read"],[71,25,41,29],[71,26,41,30],[71,27,41,31],[71,28,42,25,"then"],[71,32,42,29],[71,33,42,30,"_ref"],[71,37,42,30],[71,41,42,51],[72,16,42,51],[72,20,42,33,"done"],[72,24,42,37],[72,27,42,37,"_ref"],[72,31,42,37],[72,32,42,33,"done"],[72,36,42,37],[73,18,42,39,"value"],[73,23,42,44],[73,26,42,44,"_ref"],[73,30,42,44],[73,31,42,39,"value"],[73,36,42,44],[74,16,43,24],[74,20,43,28,"done"],[74,24,43,32],[74,26,43,34],[75,18,44,28],[76,16,45,24],[77,16,46,24],[77,20,46,28],[77,21,46,29,"onPacket"],[77,29,46,37],[77,30,46,38,"value"],[77,35,46,43],[77,36,46,44],[78,16,47,24,"read"],[78,20,47,28],[78,21,47,29],[78,22,47,30],[79,14,48,20],[79,15,48,21],[79,16,48,22],[79,17,49,25,"catch"],[79,22,49,30],[79,23,49,32,"err"],[79,26,49,35],[79,30,49,40],[79,31,50,20],[79,32,50,21],[79,33,50,22],[80,12,51,16],[80,13,51,17],[81,12,52,16,"read"],[81,16,52,20],[81,17,52,21],[81,18,52,22],[82,12,53,16],[82,16,53,22,"packet"],[82,22,53,28],[82,25,53,31],[83,14,53,33,"type"],[83,18,53,37],[83,20,53,39],[84,12,53,46],[84,13,53,47],[85,12,54,16],[85,16,54,20],[85,20,54,24],[85,21,54,25,"query"],[85,26,54,30],[85,27,54,31,"sid"],[85,30,54,34],[85,32,54,36],[86,14,55,20,"packet"],[86,20,55,26],[86,21,55,27,"data"],[86,25,55,31],[86,28,55,34],[86,39,55,45],[86,43,55,49],[86,44,55,50,"query"],[86,49,55,55],[86,50,55,56,"sid"],[86,53,55,59],[86,57,55,63],[87,12,56,16],[88,12,57,16],[88,16,57,20],[88,17,57,21,"_writer"],[88,24,57,28],[88,25,57,29,"write"],[88,30,57,34],[88,31,57,35,"packet"],[88,37,57,41],[88,38,57,42],[88,39,57,43,"then"],[88,43,57,47],[88,44,57,48],[88,50,57,54],[88,54,57,58],[88,55,57,59,"onOpen"],[88,61,57,65],[88,62,57,66],[88,63,57,67],[88,64,57,68],[89,10,58,12],[89,11,58,13],[89,12,58,14],[90,8,59,8],[90,9,59,9],[90,10,59,10],[91,6,60,4],[92,4,60,5],[93,6,60,5,"key"],[93,9,60,5],[94,6,60,5,"value"],[94,11,60,5],[94,13,61,4],[94,22,61,4,"write"],[94,27,61,9,"write"],[94,28,61,10,"packets"],[94,35,61,17],[94,37,61,19],[95,8,61,19],[95,12,61,19,"_this"],[95,17,61,19],[96,8,62,8],[96,12,62,12],[96,13,62,13,"writable"],[96,21,62,21],[96,24,62,24],[96,29,62,29],[97,8,62,30],[97,12,62,30,"_loop"],[97,17,62,30],[97,29,62,30,"_loop"],[97,30,62,30],[97,32,63,49],[98,10,64,12],[98,14,64,18,"packet"],[98,20,64,24],[98,23,64,27,"packets"],[98,30,64,34],[98,31,64,35,"i"],[98,32,64,36],[98,33,64,37],[99,10,65,12],[99,14,65,18,"lastPacket"],[99,24,65,28],[99,27,65,31,"i"],[99,28,65,32],[99,33,65,37,"packets"],[99,40,65,44],[99,41,65,45,"length"],[99,47,65,51],[99,50,65,54],[99,51,65,55],[100,10,66,12,"_this"],[100,15,66,16],[100,16,66,17,"_writer"],[100,23,66,24],[100,24,66,25,"write"],[100,29,66,30],[100,30,66,31,"packet"],[100,36,66,37],[100,37,66,38],[100,38,66,39,"then"],[100,42,66,43],[100,43,66,44],[100,49,66,50],[101,12,67,16],[101,16,67,20,"lastPacket"],[101,26,67,30],[101,28,67,32],[102,14,68,20],[102,18,68,20,"nextTick"],[102,32,68,28],[102,33,68,28,"nextTick"],[102,41,68,28],[102,43,68,29],[102,49,68,35],[103,16,69,24,"_this"],[103,21,69,28],[103,22,69,29,"writable"],[103,30,69,37],[103,33,69,40],[103,37,69,44],[104,16,70,24,"_this"],[104,21,70,28],[104,22,70,29,"emitReserved"],[104,34,70,41],[104,35,70,42],[104,42,70,49],[104,43,70,50],[105,14,71,20],[105,15,71,21],[105,17,71,23,"_this"],[105,22,71,27],[105,23,71,28,"setTimeoutFn"],[105,35,71,40],[105,36,71,41],[106,12,72,16],[107,10,73,12],[107,11,73,13],[107,12,73,14],[108,8,74,8],[108,9,74,9],[109,8,63,8],[109,13,63,13],[109,17,63,17,"i"],[109,18,63,18],[109,21,63,21],[109,22,63,22],[109,24,63,24,"i"],[109,25,63,25],[109,28,63,28,"packets"],[109,35,63,35],[109,36,63,36,"length"],[109,42,63,42],[109,44,63,44,"i"],[109,45,63,45],[109,47,63,47],[110,10,63,47,"_loop"],[110,15,63,47],[111,8,63,47],[112,6,75,4],[113,4,75,5],[114,6,75,5,"key"],[114,9,75,5],[115,6,75,5,"value"],[115,11,75,5],[115,13,76,4],[115,22,76,4,"doClose"],[115,29,76,11,"doClose"],[115,30,76,11],[115,32,76,14],[116,8,77,8],[116,12,77,12,"_a"],[116,14,77,14],[117,8,78,8],[117,9,78,9,"_a"],[117,11,78,11],[117,14,78,14],[117,18,78,18],[117,19,78,19,"_transport"],[117,29,78,29],[117,35,78,35],[117,39,78,39],[117,43,78,43,"_a"],[117,45,78,45],[117,50,78,50],[117,55,78,55],[117,56,78,56],[117,59,78,59],[117,64,78,64],[117,65,78,65],[117,68,78,68,"_a"],[117,70,78,70],[117,71,78,71,"close"],[117,76,78,76],[117,77,78,77],[117,78,78,78],[118,6,79,4],[119,4,79,5],[120,2,79,5],[120,4,12,24,"Transport"],[120,16,12,33],[120,17,12,33,"Transport"],[120,26,12,33],[121,0,12,33],[121,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCW;ICC;KDE;IEC;kBCS;SDE;mBEC;SFE;mCGE;6DCC;6BCM;8BCG;qBDM;+BEC;qBFC;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"},"hasCjsExports":false},"type":"js/module"}]}