{"dependencies":[{"name":"./polling.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"Pl+iaQVK3G0OaUHovkJUbWBEusk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"Fetch\", {\n    enumerable: true,\n    get: function () {\n      return Fetch;\n    }\n  });\n  var _pollingJs = require(_dependencyMap[0], \"./polling.js\");\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  class Fetch extends _pollingJs.Polling {\n    doPoll() {\n      this._fetch().then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch read error\", res.status, res);\n        }\n        res.text().then(data => this.onData(data));\n      }).catch(err => {\n        this.onError(\"fetch read error\", err);\n      });\n    }\n    doWrite(data, callback) {\n      this._fetch(data).then(res => {\n        if (!res.ok) {\n          return this.onError(\"fetch write error\", res.status, res);\n        }\n        callback();\n      }).catch(err => {\n        this.onError(\"fetch write error\", err);\n      });\n    }\n    _fetch(data) {\n      var _a;\n      const isPost = data !== undefined;\n      const headers = new Headers(this.opts.extraHeaders);\n      if (isPost) {\n        headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n      }\n      (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n      return fetch(this.uri(), {\n        method: isPost ? \"POST\" : \"GET\",\n        body: isPost ? data : null,\n        headers,\n        credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n      }).then(res => {\n        var _a;\n        // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n        return res;\n      });\n    }\n  }\n});","lineCount":65,"map":[[7,2,11,0,"Object"],[7,8,11,0],[7,9,11,0,"defineProperty"],[7,23,11,0],[7,24,11,0,"exports"],[7,31,11,0],[8,4,11,0,"enumerable"],[8,14,11,0],[9,4,11,0,"get"],[9,7,11,0],[9,18,11,0,"get"],[9,19,11,0],[10,6,11,0],[10,13,11,0,"Fetch"],[10,18,11,0],[11,4,11,0],[12,2,11,0],[13,2,1,0],[13,6,1,0,"_pollingJs"],[13,16,1,0],[13,19,1,0,"require"],[13,26,1,0],[13,27,1,0,"_dependencyMap"],[13,41,1,0],[14,2,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,2,11,7],[23,8,11,13,"Fetch"],[23,13,11,18],[23,22,11,27,"Polling"],[23,32,11,34],[23,33,11,34,"Polling"],[23,40,11,34],[23,41,11,35],[24,4,12,4,"doPoll"],[24,10,12,10,"doPoll"],[24,11,12,10],[24,13,12,13],[25,6,13,8],[25,10,13,12],[25,11,13,13,"_fetch"],[25,17,13,19],[25,18,13,20],[25,19,13,21],[25,20,14,13,"then"],[25,24,14,17],[25,25,14,19,"res"],[25,28,14,22],[25,32,14,27],[26,8,15,12],[26,12,15,16],[26,13,15,17,"res"],[26,16,15,20],[26,17,15,21,"ok"],[26,19,15,23],[26,21,15,25],[27,10,16,16],[27,17,16,23],[27,21,16,27],[27,22,16,28,"onError"],[27,29,16,35],[27,30,16,36],[27,48,16,54],[27,50,16,56,"res"],[27,53,16,59],[27,54,16,60,"status"],[27,60,16,66],[27,62,16,68,"res"],[27,65,16,71],[27,66,16,72],[28,8,17,12],[29,8,18,12,"res"],[29,11,18,15],[29,12,18,16,"text"],[29,16,18,20],[29,17,18,21],[29,18,18,22],[29,19,18,23,"then"],[29,23,18,27],[29,24,18,29,"data"],[29,28,18,33],[29,32,18,38],[29,36,18,42],[29,37,18,43,"onData"],[29,43,18,49],[29,44,18,50,"data"],[29,48,18,54],[29,49,18,55],[29,50,18,56],[30,6,19,8],[30,7,19,9],[30,8,19,10],[30,9,20,13,"catch"],[30,14,20,18],[30,15,20,20,"err"],[30,18,20,23],[30,22,20,28],[31,8,21,12],[31,12,21,16],[31,13,21,17,"onError"],[31,20,21,24],[31,21,21,25],[31,39,21,43],[31,41,21,45,"err"],[31,44,21,48],[31,45,21,49],[32,6,22,8],[32,7,22,9],[32,8,22,10],[33,4,23,4],[34,4,24,4,"doWrite"],[34,11,24,11,"doWrite"],[34,12,24,12,"data"],[34,16,24,16],[34,18,24,18,"callback"],[34,26,24,26],[34,28,24,28],[35,6,25,8],[35,10,25,12],[35,11,25,13,"_fetch"],[35,17,25,19],[35,18,25,20,"data"],[35,22,25,24],[35,23,25,25],[35,24,26,13,"then"],[35,28,26,17],[35,29,26,19,"res"],[35,32,26,22],[35,36,26,27],[36,8,27,12],[36,12,27,16],[36,13,27,17,"res"],[36,16,27,20],[36,17,27,21,"ok"],[36,19,27,23],[36,21,27,25],[37,10,28,16],[37,17,28,23],[37,21,28,27],[37,22,28,28,"onError"],[37,29,28,35],[37,30,28,36],[37,49,28,55],[37,51,28,57,"res"],[37,54,28,60],[37,55,28,61,"status"],[37,61,28,67],[37,63,28,69,"res"],[37,66,28,72],[37,67,28,73],[38,8,29,12],[39,8,30,12,"callback"],[39,16,30,20],[39,17,30,21],[39,18,30,22],[40,6,31,8],[40,7,31,9],[40,8,31,10],[40,9,32,13,"catch"],[40,14,32,18],[40,15,32,20,"err"],[40,18,32,23],[40,22,32,28],[41,8,33,12],[41,12,33,16],[41,13,33,17,"onError"],[41,20,33,24],[41,21,33,25],[41,40,33,44],[41,42,33,46,"err"],[41,45,33,49],[41,46,33,50],[42,6,34,8],[42,7,34,9],[42,8,34,10],[43,4,35,4],[44,4,36,4,"_fetch"],[44,10,36,10,"_fetch"],[44,11,36,11,"data"],[44,15,36,15],[44,17,36,17],[45,6,37,8],[45,10,37,12,"_a"],[45,12,37,14],[46,6,38,8],[46,12,38,14,"isPost"],[46,18,38,20],[46,21,38,23,"data"],[46,25,38,27],[46,30,38,32,"undefined"],[46,39,38,41],[47,6,39,8],[47,12,39,14,"headers"],[47,19,39,21],[47,22,39,24],[47,26,39,28,"Headers"],[47,33,39,35],[47,34,39,36],[47,38,39,40],[47,39,39,41,"opts"],[47,43,39,45],[47,44,39,46,"extraHeaders"],[47,56,39,58],[47,57,39,59],[48,6,40,8],[48,10,40,12,"isPost"],[48,16,40,18],[48,18,40,20],[49,8,41,12,"headers"],[49,15,41,19],[49,16,41,20,"set"],[49,19,41,23],[49,20,41,24],[49,34,41,38],[49,36,41,40],[49,62,41,66],[49,63,41,67],[50,6,42,8],[51,6,43,8],[51,7,43,9,"_a"],[51,9,43,11],[51,12,43,14],[51,16,43,18],[51,17,43,19,"socket"],[51,23,43,25],[51,24,43,26,"_cookieJar"],[51,34,43,36],[51,40,43,42],[51,44,43,46],[51,48,43,50,"_a"],[51,50,43,52],[51,55,43,57],[51,60,43,62],[51,61,43,63],[51,64,43,66],[51,69,43,71],[51,70,43,72],[51,73,43,75,"_a"],[51,75,43,77],[51,76,43,78,"appendCookies"],[51,89,43,91],[51,90,43,92,"headers"],[51,97,43,99],[51,98,43,100],[52,6,44,8],[52,13,44,15,"fetch"],[52,18,44,20],[52,19,44,21],[52,23,44,25],[52,24,44,26,"uri"],[52,27,44,29],[52,28,44,30],[52,29,44,31],[52,31,44,33],[53,8,45,12,"method"],[53,14,45,18],[53,16,45,20,"isPost"],[53,22,45,26],[53,25,45,29],[53,31,45,35],[53,34,45,38],[53,39,45,43],[54,8,46,12,"body"],[54,12,46,16],[54,14,46,18,"isPost"],[54,20,46,24],[54,23,46,27,"data"],[54,27,46,31],[54,30,46,34],[54,34,46,38],[55,8,47,12,"headers"],[55,15,47,19],[56,8,48,12,"credentials"],[56,19,48,23],[56,21,48,25],[56,25,48,29],[56,26,48,30,"opts"],[56,30,48,34],[56,31,48,35,"withCredentials"],[56,46,48,50],[56,49,48,53],[56,58,48,62],[56,61,48,65],[57,6,49,8],[57,7,49,9],[57,8,49,10],[57,9,49,11,"then"],[57,13,49,15],[57,14,49,17,"res"],[57,17,49,20],[57,21,49,25],[58,8,50,12],[58,12,50,16,"_a"],[58,14,50,18],[59,8,51,12],[60,8,52,12],[60,9,52,13,"_a"],[60,11,52,15],[60,14,52,18],[60,18,52,22],[60,19,52,23,"socket"],[60,25,52,29],[60,26,52,30,"_cookieJar"],[60,36,52,40],[60,42,52,46],[60,46,52,50],[60,50,52,54,"_a"],[60,52,52,56],[60,57,52,61],[60,62,52,66],[60,63,52,67],[60,66,52,70],[60,71,52,75],[60,72,52,76],[60,75,52,79,"_a"],[60,77,52,81],[60,78,52,82,"parseCookies"],[60,90,52,94],[60,91,52,95,"res"],[60,94,52,98],[60,95,52,99,"headers"],[60,102,52,106],[60,103,52,107,"getSetCookie"],[60,115,52,119],[60,116,52,120],[60,117,52,121],[60,118,52,122],[61,8,53,12],[61,15,53,19,"res"],[61,18,53,22],[62,6,54,8],[62,7,54,9],[62,8,54,10],[63,4,55,4],[64,2,56,0],[65,0,56,1],[65,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;OCU;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"},"hasCjsExports":false},"type":"js/module"}]}