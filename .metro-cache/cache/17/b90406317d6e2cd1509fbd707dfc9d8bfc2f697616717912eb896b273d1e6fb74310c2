{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/callSuper","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"378KbBHdmndC3iMXZ2Ix8oB3LeE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"],"imports":1}},{"name":"./polling.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"Pl+iaQVK3G0OaUHovkJUbWBEusk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"Fetch\", {\n    enumerable: true,\n    get: function () {\n      return Fetch;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\");\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\");\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _babelRuntimeHelpersCallSuper = require(_dependencyMap[2], \"@babel/runtime/helpers/callSuper\");\n  var _callSuper = _interopDefault(_babelRuntimeHelpersCallSuper);\n  var _babelRuntimeHelpersInherits = require(_dependencyMap[3], \"@babel/runtime/helpers/inherits\");\n  var _inherits = _interopDefault(_babelRuntimeHelpersInherits);\n  var _pollingJs = require(_dependencyMap[4], \"./polling.js\");\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  var Fetch = /*#__PURE__*/function (_Polling) {\n    function Fetch() {\n      (0, _classCallCheck.default)(this, Fetch);\n      return (0, _callSuper.default)(this, Fetch, arguments);\n    }\n    (0, _inherits.default)(Fetch, _Polling);\n    return (0, _createClass.default)(Fetch, [{\n      key: \"doPoll\",\n      value: function doPoll() {\n        this._fetch().then(res => {\n          if (!res.ok) {\n            return this.onError(\"fetch read error\", res.status, res);\n          }\n          res.text().then(data => this.onData(data));\n        }).catch(err => {\n          this.onError(\"fetch read error\", err);\n        });\n      }\n    }, {\n      key: \"doWrite\",\n      value: function doWrite(data, callback) {\n        this._fetch(data).then(res => {\n          if (!res.ok) {\n            return this.onError(\"fetch write error\", res.status, res);\n          }\n          callback();\n        }).catch(err => {\n          this.onError(\"fetch write error\", err);\n        });\n      }\n    }, {\n      key: \"_fetch\",\n      value: function _fetch(data) {\n        var _a;\n        var isPost = data !== undefined;\n        var headers = new Headers(this.opts.extraHeaders);\n        if (isPost) {\n          headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n        }\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n        return fetch(this.uri(), {\n          method: isPost ? \"POST\" : \"GET\",\n          body: isPost ? data : null,\n          headers,\n          credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n        }).then(res => {\n          var _a;\n          // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n          (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n          return res;\n        });\n      }\n    }]);\n  }(_pollingJs.Polling);\n});","lineCount":90,"map":[[12,2,11,0,"Object"],[12,8,11,0],[12,9,11,0,"defineProperty"],[12,23,11,0],[12,24,11,0,"exports"],[12,31,11,0],[13,4,11,0,"enumerable"],[13,14,11,0],[14,4,11,0,"get"],[14,7,11,0],[14,18,11,0,"get"],[14,19,11,0],[15,6,11,0],[15,13,11,0,"Fetch"],[15,18,11,0],[16,4,11,0],[17,2,11,0],[18,2,56,1],[18,6,56,1,"_babelRuntimeHelpersClassCallCheck"],[18,40,56,1],[18,43,56,1,"require"],[18,50,56,1],[18,51,56,1,"_dependencyMap"],[18,65,56,1],[19,2,56,1],[19,6,56,1,"_classCallCheck"],[19,21,56,1],[19,24,56,1,"_interopDefault"],[19,39,56,1],[19,40,56,1,"_babelRuntimeHelpersClassCallCheck"],[19,74,56,1],[20,2,56,1],[20,6,56,1,"_babelRuntimeHelpersCreateClass"],[20,37,56,1],[20,40,56,1,"require"],[20,47,56,1],[20,48,56,1,"_dependencyMap"],[20,62,56,1],[21,2,56,1],[21,6,56,1,"_createClass"],[21,18,56,1],[21,21,56,1,"_interopDefault"],[21,36,56,1],[21,37,56,1,"_babelRuntimeHelpersCreateClass"],[21,68,56,1],[22,2,56,1],[22,6,56,1,"_babelRuntimeHelpersCallSuper"],[22,35,56,1],[22,38,56,1,"require"],[22,45,56,1],[22,46,56,1,"_dependencyMap"],[22,60,56,1],[23,2,56,1],[23,6,56,1,"_callSuper"],[23,16,56,1],[23,19,56,1,"_interopDefault"],[23,34,56,1],[23,35,56,1,"_babelRuntimeHelpersCallSuper"],[23,64,56,1],[24,2,56,1],[24,6,56,1,"_babelRuntimeHelpersInherits"],[24,34,56,1],[24,37,56,1,"require"],[24,44,56,1],[24,45,56,1,"_dependencyMap"],[24,59,56,1],[25,2,56,1],[25,6,56,1,"_inherits"],[25,15,56,1],[25,18,56,1,"_interopDefault"],[25,33,56,1],[25,34,56,1,"_babelRuntimeHelpersInherits"],[25,62,56,1],[26,2,1,0],[26,6,1,0,"_pollingJs"],[26,16,1,0],[26,19,1,0,"require"],[26,26,1,0],[26,27,1,0,"_dependencyMap"],[26,41,1,0],[27,2,2,0],[28,0,3,0],[29,0,4,0],[30,0,5,0],[31,0,6,0],[32,0,7,0],[33,0,8,0],[34,0,9,0],[35,0,10,0],[36,2,2,0],[36,6,11,13,"Fetch"],[36,11,11,18],[36,37,11,18,"_Polling"],[36,45,11,18],[37,4,11,18],[37,13,11,18,"Fetch"],[37,19,11,18],[38,6,11,18],[38,10,11,18,"_classCallCheck"],[38,25,11,18],[38,26,11,18,"default"],[38,33,11,18],[38,41,11,18,"Fetch"],[38,46,11,18],[39,6,11,18],[39,17,11,18,"_callSuper"],[39,27,11,18],[39,28,11,18,"default"],[39,35,11,18],[39,43,11,18,"Fetch"],[39,48,11,18],[39,50,11,18,"arguments"],[39,59,11,18],[40,4,11,18],[41,4,11,18],[41,8,11,18,"_inherits"],[41,17,11,18],[41,18,11,18,"default"],[41,25,11,18],[41,27,11,18,"Fetch"],[41,32,11,18],[41,34,11,18,"_Polling"],[41,42,11,18],[42,4,11,18],[42,15,11,18,"_createClass"],[42,27,11,18],[42,28,11,18,"default"],[42,35,11,18],[42,37,11,18,"Fetch"],[42,42,11,18],[43,6,11,18,"key"],[43,9,11,18],[44,6,11,18,"value"],[44,11,11,18],[44,13,12,4],[44,22,12,4,"doPoll"],[44,28,12,10,"doPoll"],[44,29,12,10],[44,31,12,13],[45,8,13,8],[45,12,13,12],[45,13,13,13,"_fetch"],[45,19,13,19],[45,20,13,20],[45,21,13,21],[45,22,14,13,"then"],[45,26,14,17],[45,27,14,19,"res"],[45,30,14,22],[45,34,14,27],[46,10,15,12],[46,14,15,16],[46,15,15,17,"res"],[46,18,15,20],[46,19,15,21,"ok"],[46,21,15,23],[46,23,15,25],[47,12,16,16],[47,19,16,23],[47,23,16,27],[47,24,16,28,"onError"],[47,31,16,35],[47,32,16,36],[47,50,16,54],[47,52,16,56,"res"],[47,55,16,59],[47,56,16,60,"status"],[47,62,16,66],[47,64,16,68,"res"],[47,67,16,71],[47,68,16,72],[48,10,17,12],[49,10,18,12,"res"],[49,13,18,15],[49,14,18,16,"text"],[49,18,18,20],[49,19,18,21],[49,20,18,22],[49,21,18,23,"then"],[49,25,18,27],[49,26,18,29,"data"],[49,30,18,33],[49,34,18,38],[49,38,18,42],[49,39,18,43,"onData"],[49,45,18,49],[49,46,18,50,"data"],[49,50,18,54],[49,51,18,55],[49,52,18,56],[50,8,19,8],[50,9,19,9],[50,10,19,10],[50,11,20,13,"catch"],[50,16,20,18],[50,17,20,20,"err"],[50,20,20,23],[50,24,20,28],[51,10,21,12],[51,14,21,16],[51,15,21,17,"onError"],[51,22,21,24],[51,23,21,25],[51,41,21,43],[51,43,21,45,"err"],[51,46,21,48],[51,47,21,49],[52,8,22,8],[52,9,22,9],[52,10,22,10],[53,6,23,4],[54,4,23,5],[55,6,23,5,"key"],[55,9,23,5],[56,6,23,5,"value"],[56,11,23,5],[56,13,24,4],[56,22,24,4,"doWrite"],[56,29,24,11,"doWrite"],[56,30,24,12,"data"],[56,34,24,16],[56,36,24,18,"callback"],[56,44,24,26],[56,46,24,28],[57,8,25,8],[57,12,25,12],[57,13,25,13,"_fetch"],[57,19,25,19],[57,20,25,20,"data"],[57,24,25,24],[57,25,25,25],[57,26,26,13,"then"],[57,30,26,17],[57,31,26,19,"res"],[57,34,26,22],[57,38,26,27],[58,10,27,12],[58,14,27,16],[58,15,27,17,"res"],[58,18,27,20],[58,19,27,21,"ok"],[58,21,27,23],[58,23,27,25],[59,12,28,16],[59,19,28,23],[59,23,28,27],[59,24,28,28,"onError"],[59,31,28,35],[59,32,28,36],[59,51,28,55],[59,53,28,57,"res"],[59,56,28,60],[59,57,28,61,"status"],[59,63,28,67],[59,65,28,69,"res"],[59,68,28,72],[59,69,28,73],[60,10,29,12],[61,10,30,12,"callback"],[61,18,30,20],[61,19,30,21],[61,20,30,22],[62,8,31,8],[62,9,31,9],[62,10,31,10],[62,11,32,13,"catch"],[62,16,32,18],[62,17,32,20,"err"],[62,20,32,23],[62,24,32,28],[63,10,33,12],[63,14,33,16],[63,15,33,17,"onError"],[63,22,33,24],[63,23,33,25],[63,42,33,44],[63,44,33,46,"err"],[63,47,33,49],[63,48,33,50],[64,8,34,8],[64,9,34,9],[64,10,34,10],[65,6,35,4],[66,4,35,5],[67,6,35,5,"key"],[67,9,35,5],[68,6,35,5,"value"],[68,11,35,5],[68,13,36,4],[68,22,36,4,"_fetch"],[68,28,36,10,"_fetch"],[68,29,36,11,"data"],[68,33,36,15],[68,35,36,17],[69,8,37,8],[69,12,37,12,"_a"],[69,14,37,14],[70,8,38,8],[70,12,38,14,"isPost"],[70,18,38,20],[70,21,38,23,"data"],[70,25,38,27],[70,30,38,32,"undefined"],[70,39,38,41],[71,8,39,8],[71,12,39,14,"headers"],[71,19,39,21],[71,22,39,24],[71,26,39,28,"Headers"],[71,33,39,35],[71,34,39,36],[71,38,39,40],[71,39,39,41,"opts"],[71,43,39,45],[71,44,39,46,"extraHeaders"],[71,56,39,58],[71,57,39,59],[72,8,40,8],[72,12,40,12,"isPost"],[72,18,40,18],[72,20,40,20],[73,10,41,12,"headers"],[73,17,41,19],[73,18,41,20,"set"],[73,21,41,23],[73,22,41,24],[73,36,41,38],[73,38,41,40],[73,64,41,66],[73,65,41,67],[74,8,42,8],[75,8,43,8],[75,9,43,9,"_a"],[75,11,43,11],[75,14,43,14],[75,18,43,18],[75,19,43,19,"socket"],[75,25,43,25],[75,26,43,26,"_cookieJar"],[75,36,43,36],[75,42,43,42],[75,46,43,46],[75,50,43,50,"_a"],[75,52,43,52],[75,57,43,57],[75,62,43,62],[75,63,43,63],[75,66,43,66],[75,71,43,71],[75,72,43,72],[75,75,43,75,"_a"],[75,77,43,77],[75,78,43,78,"appendCookies"],[75,91,43,91],[75,92,43,92,"headers"],[75,99,43,99],[75,100,43,100],[76,8,44,8],[76,15,44,15,"fetch"],[76,20,44,20],[76,21,44,21],[76,25,44,25],[76,26,44,26,"uri"],[76,29,44,29],[76,30,44,30],[76,31,44,31],[76,33,44,33],[77,10,45,12,"method"],[77,16,45,18],[77,18,45,20,"isPost"],[77,24,45,26],[77,27,45,29],[77,33,45,35],[77,36,45,38],[77,41,45,43],[78,10,46,12,"body"],[78,14,46,16],[78,16,46,18,"isPost"],[78,22,46,24],[78,25,46,27,"data"],[78,29,46,31],[78,32,46,34],[78,36,46,38],[79,10,47,12,"headers"],[79,17,47,19],[80,10,48,12,"credentials"],[80,21,48,23],[80,23,48,25],[80,27,48,29],[80,28,48,30,"opts"],[80,32,48,34],[80,33,48,35,"withCredentials"],[80,48,48,50],[80,51,48,53],[80,60,48,62],[80,63,48,65],[81,8,49,8],[81,9,49,9],[81,10,49,10],[81,11,49,11,"then"],[81,15,49,15],[81,16,49,17,"res"],[81,19,49,20],[81,23,49,25],[82,10,50,12],[82,14,50,16,"_a"],[82,16,50,18],[83,10,51,12],[84,10,52,12],[84,11,52,13,"_a"],[84,13,52,15],[84,16,52,18],[84,20,52,22],[84,21,52,23,"socket"],[84,27,52,29],[84,28,52,30,"_cookieJar"],[84,38,52,40],[84,44,52,46],[84,48,52,50],[84,52,52,54,"_a"],[84,54,52,56],[84,59,52,61],[84,64,52,66],[84,65,52,67],[84,68,52,70],[84,73,52,75],[84,74,52,76],[84,77,52,79,"_a"],[84,79,52,81],[84,80,52,82,"parseCookies"],[84,92,52,94],[84,93,52,95,"res"],[84,96,52,98],[84,97,52,99,"headers"],[84,104,52,106],[84,105,52,107,"getSetCookie"],[84,117,52,119],[84,118,52,120],[84,119,52,121],[84,120,52,122],[85,10,53,12],[85,17,53,19,"res"],[85,20,53,22],[86,8,54,8],[86,9,54,9],[86,10,54,10],[87,6,55,4],[88,4,55,5],[89,2,55,5],[89,4,11,27,"Polling"],[89,14,11,34],[89,15,11,34,"Polling"],[89,22,11,34],[90,0,11,34],[90,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;OCU;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"},"hasCjsExports":false},"type":"js/module"}]}