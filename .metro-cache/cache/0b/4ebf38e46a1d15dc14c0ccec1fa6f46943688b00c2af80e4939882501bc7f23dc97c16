{"dependencies":[{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"],"imports":1}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"],"imports":1}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"WT\", {\n    enumerable: true,\n    get: function () {\n      return WT;\n    }\n  });\n  var _transportJs = require(_dependencyMap[0], \"../transport.js\");\n  var _globalsNodeJs = require(_dependencyMap[1], \"../globals.node.js\");\n  var _engineIoParser = require(_dependencyMap[2], \"engine.io-parser\");\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  class WT extends _transportJs.Transport {\n    get name() {\n      return \"webtransport\";\n    }\n    doOpen() {\n      try {\n        // @ts-ignore\n        this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n      } catch (err) {\n        return this.emitReserved(\"error\", err);\n      }\n      this._transport.closed.then(() => {\n        this.onClose();\n      }).catch(err => {\n        this.onError(\"webtransport error\", err);\n      });\n      // note: we could have used async/await, but that would require some additional polyfills\n      this._transport.ready.then(() => {\n        this._transport.createBidirectionalStream().then(stream => {\n          const decoderStream = (0, _engineIoParser.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n          const reader = stream.readable.pipeThrough(decoderStream).getReader();\n          const encoderStream = (0, _engineIoParser.createPacketEncoderStream)();\n          encoderStream.readable.pipeTo(stream.writable);\n          this._writer = encoderStream.writable.getWriter();\n          const read = () => {\n            reader.read().then(({\n              done,\n              value\n            }) => {\n              if (done) {\n                return;\n              }\n              this.onPacket(value);\n              read();\n            }).catch(err => {});\n          };\n          read();\n          const packet = {\n            type: \"open\"\n          };\n          if (this.query.sid) {\n            packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n          }\n          this._writer.write(packet).then(() => this.onOpen());\n        });\n      });\n    }\n    write(packets) {\n      this.writable = false;\n      for (let i = 0; i < packets.length; i++) {\n        const packet = packets[i];\n        const lastPacket = i === packets.length - 1;\n        this._writer.write(packet).then(() => {\n          if (lastPacket) {\n            (0, _globalsNodeJs.nextTick)(() => {\n              this.writable = true;\n              this.emitReserved(\"drain\");\n            }, this.setTimeoutFn);\n          }\n        });\n      }\n    }\n    doClose() {\n      var _a;\n      (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n  }\n});","lineCount":91,"map":[[7,2,12,0,"Object"],[7,8,12,0],[7,9,12,0,"defineProperty"],[7,23,12,0],[7,24,12,0,"exports"],[7,31,12,0],[8,4,12,0,"enumerable"],[8,14,12,0],[9,4,12,0,"get"],[9,7,12,0],[9,18,12,0,"get"],[9,19,12,0],[10,6,12,0],[10,13,12,0,"WT"],[10,15,12,0],[11,4,12,0],[12,2,12,0],[13,2,1,0],[13,6,1,0,"_transportJs"],[13,18,1,0],[13,21,1,0,"require"],[13,28,1,0],[13,29,1,0,"_dependencyMap"],[13,43,1,0],[14,2,2,0],[14,6,2,0,"_globalsNodeJs"],[14,20,2,0],[14,23,2,0,"require"],[14,30,2,0],[14,31,2,0,"_dependencyMap"],[14,45,2,0],[15,2,3,0],[15,6,3,0,"_engineIoParser"],[15,21,3,0],[15,24,3,0,"require"],[15,31,3,0],[15,32,3,0,"_dependencyMap"],[15,46,3,0],[16,2,4,0],[17,0,5,0],[18,0,6,0],[19,0,7,0],[20,0,8,0],[21,0,9,0],[22,0,10,0],[23,0,11,0],[24,2,12,7],[24,8,12,13,"WT"],[24,10,12,15],[24,19,12,24,"Transport"],[24,31,12,33],[24,32,12,33,"Transport"],[24,41,12,33],[24,42,12,34],[25,4,13,4],[25,8,13,8,"name"],[25,12,13,12,"name"],[25,13,13,12],[25,15,13,15],[26,6,14,8],[26,13,14,15],[26,27,14,29],[27,4,15,4],[28,4,16,4,"doOpen"],[28,10,16,10,"doOpen"],[28,11,16,10],[28,13,16,13],[29,6,17,8],[29,10,17,12],[30,8,18,12],[31,8,19,12],[31,12,19,16],[31,13,19,17,"_transport"],[31,23,19,27],[31,26,19,30],[31,30,19,34,"WebTransport"],[31,42,19,46],[31,43,19,47],[31,47,19,51],[31,48,19,52,"createUri"],[31,57,19,61],[31,58,19,62],[31,65,19,69],[31,66,19,70],[31,68,19,72],[31,72,19,76],[31,73,19,77,"opts"],[31,77,19,81],[31,78,19,82,"transportOptions"],[31,94,19,98],[31,95,19,99],[31,99,19,103],[31,100,19,104,"name"],[31,104,19,108],[31,105,19,109],[31,106,19,110],[32,6,20,8],[32,7,20,9],[32,8,21,8],[32,15,21,15,"err"],[32,18,21,18],[32,20,21,20],[33,8,22,12],[33,15,22,19],[33,19,22,23],[33,20,22,24,"emitReserved"],[33,32,22,36],[33,33,22,37],[33,40,22,44],[33,42,22,46,"err"],[33,45,22,49],[33,46,22,50],[34,6,23,8],[35,6,24,8],[35,10,24,12],[35,11,24,13,"_transport"],[35,21,24,23],[35,22,24,24,"closed"],[35,28,24,30],[35,29,25,13,"then"],[35,33,25,17],[35,34,25,18],[35,40,25,24],[36,8,26,12],[36,12,26,16],[36,13,26,17,"onClose"],[36,20,26,24],[36,21,26,25],[36,22,26,26],[37,6,27,8],[37,7,27,9],[37,8,27,10],[37,9,28,13,"catch"],[37,14,28,18],[37,15,28,20,"err"],[37,18,28,23],[37,22,28,28],[38,8,29,12],[38,12,29,16],[38,13,29,17,"onError"],[38,20,29,24],[38,21,29,25],[38,41,29,45],[38,43,29,47,"err"],[38,46,29,50],[38,47,29,51],[39,6,30,8],[39,7,30,9],[39,8,30,10],[40,6,31,8],[41,6,32,8],[41,10,32,12],[41,11,32,13,"_transport"],[41,21,32,23],[41,22,32,24,"ready"],[41,27,32,29],[41,28,32,30,"then"],[41,32,32,34],[41,33,32,35],[41,39,32,41],[42,8,33,12],[42,12,33,16],[42,13,33,17,"_transport"],[42,23,33,27],[42,24,33,28,"createBidirectionalStream"],[42,49,33,53],[42,50,33,54],[42,51,33,55],[42,52,33,56,"then"],[42,56,33,60],[42,57,33,62,"stream"],[42,63,33,68],[42,67,33,73],[43,10,34,16],[43,16,34,22,"decoderStream"],[43,29,34,35],[43,32,34,38],[43,36,34,38,"createPacketDecoderStream"],[43,51,34,63],[43,52,34,63,"createPacketDecoderStream"],[43,77,34,63],[43,79,34,64,"Number"],[43,85,34,70],[43,86,34,71,"MAX_SAFE_INTEGER"],[43,102,34,87],[43,104,34,89],[43,108,34,93],[43,109,34,94,"socket"],[43,115,34,100],[43,116,34,101,"binaryType"],[43,126,34,111],[43,127,34,112],[44,10,35,16],[44,16,35,22,"reader"],[44,22,35,28],[44,25,35,31,"stream"],[44,31,35,37],[44,32,35,38,"readable"],[44,40,35,46],[44,41,35,47,"pipeThrough"],[44,52,35,58],[44,53,35,59,"decoderStream"],[44,66,35,72],[44,67,35,73],[44,68,35,74,"getReader"],[44,77,35,83],[44,78,35,84],[44,79,35,85],[45,10,36,16],[45,16,36,22,"encoderStream"],[45,29,36,35],[45,32,36,38],[45,36,36,38,"createPacketEncoderStream"],[45,51,36,63],[45,52,36,63,"createPacketEncoderStream"],[45,77,36,63],[45,79,36,64],[45,80,36,65],[46,10,37,16,"encoderStream"],[46,23,37,29],[46,24,37,30,"readable"],[46,32,37,38],[46,33,37,39,"pipeTo"],[46,39,37,45],[46,40,37,46,"stream"],[46,46,37,52],[46,47,37,53,"writable"],[46,55,37,61],[46,56,37,62],[47,10,38,16],[47,14,38,20],[47,15,38,21,"_writer"],[47,22,38,28],[47,25,38,31,"encoderStream"],[47,38,38,44],[47,39,38,45,"writable"],[47,47,38,53],[47,48,38,54,"getWriter"],[47,57,38,63],[47,58,38,64],[47,59,38,65],[48,10,39,16],[48,16,39,22,"read"],[48,20,39,26],[48,23,39,29,"read"],[48,24,39,29],[48,29,39,35],[49,12,40,20,"reader"],[49,18,40,26],[49,19,41,25,"read"],[49,23,41,29],[49,24,41,30],[49,25,41,31],[49,26,42,25,"then"],[49,30,42,29],[49,31,42,30],[49,32,42,31],[50,14,42,33,"done"],[50,18,42,37],[51,14,42,39,"value"],[52,12,42,45],[52,13,42,46],[52,18,42,51],[53,14,43,24],[53,18,43,28,"done"],[53,22,43,32],[53,24,43,34],[54,16,44,28],[55,14,45,24],[56,14,46,24],[56,18,46,28],[56,19,46,29,"onPacket"],[56,27,46,37],[56,28,46,38,"value"],[56,33,46,43],[56,34,46,44],[57,14,47,24,"read"],[57,18,47,28],[57,19,47,29],[57,20,47,30],[58,12,48,20],[58,13,48,21],[58,14,48,22],[58,15,49,25,"catch"],[58,20,49,30],[58,21,49,32,"err"],[58,24,49,35],[58,28,49,40],[58,29,50,20],[58,30,50,21],[58,31,50,22],[59,10,51,16],[59,11,51,17],[60,10,52,16,"read"],[60,14,52,20],[60,15,52,21],[60,16,52,22],[61,10,53,16],[61,16,53,22,"packet"],[61,22,53,28],[61,25,53,31],[62,12,53,33,"type"],[62,16,53,37],[62,18,53,39],[63,10,53,46],[63,11,53,47],[64,10,54,16],[64,14,54,20],[64,18,54,24],[64,19,54,25,"query"],[64,24,54,30],[64,25,54,31,"sid"],[64,28,54,34],[64,30,54,36],[65,12,55,20,"packet"],[65,18,55,26],[65,19,55,27,"data"],[65,23,55,31],[65,26,55,34],[65,37,55,45],[65,41,55,49],[65,42,55,50,"query"],[65,47,55,55],[65,48,55,56,"sid"],[65,51,55,59],[65,55,55,63],[66,10,56,16],[67,10,57,16],[67,14,57,20],[67,15,57,21,"_writer"],[67,22,57,28],[67,23,57,29,"write"],[67,28,57,34],[67,29,57,35,"packet"],[67,35,57,41],[67,36,57,42],[67,37,57,43,"then"],[67,41,57,47],[67,42,57,48],[67,48,57,54],[67,52,57,58],[67,53,57,59,"onOpen"],[67,59,57,65],[67,60,57,66],[67,61,57,67],[67,62,57,68],[68,8,58,12],[68,9,58,13],[68,10,58,14],[69,6,59,8],[69,7,59,9],[69,8,59,10],[70,4,60,4],[71,4,61,4,"write"],[71,9,61,9,"write"],[71,10,61,10,"packets"],[71,17,61,17],[71,19,61,19],[72,6,62,8],[72,10,62,12],[72,11,62,13,"writable"],[72,19,62,21],[72,22,62,24],[72,27,62,29],[73,6,63,8],[73,11,63,13],[73,15,63,17,"i"],[73,16,63,18],[73,19,63,21],[73,20,63,22],[73,22,63,24,"i"],[73,23,63,25],[73,26,63,28,"packets"],[73,33,63,35],[73,34,63,36,"length"],[73,40,63,42],[73,42,63,44,"i"],[73,43,63,45],[73,45,63,47],[73,47,63,49],[74,8,64,12],[74,14,64,18,"packet"],[74,20,64,24],[74,23,64,27,"packets"],[74,30,64,34],[74,31,64,35,"i"],[74,32,64,36],[74,33,64,37],[75,8,65,12],[75,14,65,18,"lastPacket"],[75,24,65,28],[75,27,65,31,"i"],[75,28,65,32],[75,33,65,37,"packets"],[75,40,65,44],[75,41,65,45,"length"],[75,47,65,51],[75,50,65,54],[75,51,65,55],[76,8,66,12],[76,12,66,16],[76,13,66,17,"_writer"],[76,20,66,24],[76,21,66,25,"write"],[76,26,66,30],[76,27,66,31,"packet"],[76,33,66,37],[76,34,66,38],[76,35,66,39,"then"],[76,39,66,43],[76,40,66,44],[76,46,66,50],[77,10,67,16],[77,14,67,20,"lastPacket"],[77,24,67,30],[77,26,67,32],[78,12,68,20],[78,16,68,20,"nextTick"],[78,30,68,28],[78,31,68,28,"nextTick"],[78,39,68,28],[78,41,68,29],[78,47,68,35],[79,14,69,24],[79,18,69,28],[79,19,69,29,"writable"],[79,27,69,37],[79,30,69,40],[79,34,69,44],[80,14,70,24],[80,18,70,28],[80,19,70,29,"emitReserved"],[80,31,70,41],[80,32,70,42],[80,39,70,49],[80,40,70,50],[81,12,71,20],[81,13,71,21],[81,15,71,23],[81,19,71,27],[81,20,71,28,"setTimeoutFn"],[81,32,71,40],[81,33,71,41],[82,10,72,16],[83,8,73,12],[83,9,73,13],[83,10,73,14],[84,6,74,8],[85,4,75,4],[86,4,76,4,"doClose"],[86,11,76,11,"doClose"],[86,12,76,11],[86,14,76,14],[87,6,77,8],[87,10,77,12,"_a"],[87,12,77,14],[88,6,78,8],[88,7,78,9,"_a"],[88,9,78,11],[88,12,78,14],[88,16,78,18],[88,17,78,19,"_transport"],[88,27,78,29],[88,33,78,35],[88,37,78,39],[88,41,78,43,"_a"],[88,43,78,45],[88,48,78,50],[88,53,78,55],[88,54,78,56],[88,57,78,59],[88,62,78,64],[88,63,78,65],[88,66,78,68,"_a"],[88,68,78,70],[88,69,78,71,"close"],[88,74,78,76],[88,75,78,77],[88,76,78,78],[89,4,79,4],[90,2,80,0],[91,0,80,1],[91,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCW;ICC;KDE;IEC;kBCS;SDE;mBEC;SFE;mCGE;6DCC;6BCM;8BCG;qBDM;+BEC;qBFC;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"},"hasCjsExports":false},"type":"js/module"}]}